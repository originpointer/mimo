## 03 权限与安全（最小权限 + 脱敏 + 风控边界）

### 1) 最小权限策略（强制）
- 默认不申请全域 `host_permissions`。
- 使用 `optional_host_permissions` 按域名授权：用户明确点击“授权此站点”。
- `activeTab` 仅用于“用户触发后的临时操作”，不作为长期任务基础。

#### 推荐授权交互流程
1) UI 展示当前域名与所需范围（`https://example.com/*`）。
2) 用户点击授权 -> `chrome.permissions.request({ origins: [...] })`。
3) 只有授权成功后，才允许执行 `click/type/extract/...`。

---

### 2) 数据出站与隐私边界
- 默认只上传：
  - URL/title
  - 截图（可配置开关）
  - 结构化提取字段（extracted）
  - 可见文本片段（严格截断）
- 默认不上传：
  - cookie
  - localStorage/sessionStorage
  - 密码输入
  - 全量 HTML/DOM（除非显式开启）

---

### 3) 高风险动作的安全原则
- 任何“不可逆/产生外部影响”的动作必须二次确认：
  - 提交表单、发送消息/邮件、支付/下单、删除/批量删除、权限/设置变更、发布内容。
- 确认信息必须可解释：动作类型、目标、风险原因、页面上下文（URL/标题/截图）。

---

### 4) 本地单用户鉴权（MVP）
- 插件请求带 `Authorization: Bearer <shared-secret>`。
- 后端建议仅监听 localhost（或仅开发环境启用）。
- 审计记录扩展来源（extension id、浏览器版本等）辅助排查。

---

### 5) 攻击面与防御（MVP 最小集）
- **注入/越权执行**：所有 Action 必须 schema 校验 + 工具白名单。
- **重放攻击**：actionId 幂等 + 服务端去重。
- **数据泄露**：严格脱敏与上传白名单。
- **误操作**：高风险动作强制确认 + 截图证据。
