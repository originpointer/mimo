# 产品概览：浏览器自动化能力建设

> 最后更新：2026-01-05

---

## 一句话描述

**让 AI 像人一样操作浏览器**：通过 Chrome 扩展 + 服务端 LLM，实现企业级的智能浏览器自动化。

---

## 任务目标

将开源项目 **Stagehand** 的 AI 浏览器自动化能力，迁移到 **Chrome 扩展**环境，使其能够：

1. **在员工本地运行**（桌面/CLI/扩展）
2. **由服务端远程控制**（安全、可审计）
3. **支持 LLM 驱动的智能操作**（自然语言指令）

---

## 当前进度

```
█░░░░░░░░░░░░░░░░░░░░  5% 技术可行性验证阶段（进行中）
```

### 阶段划分

| 阶段 | 占比 | 状态 | 说明 |
|------|------|------|------|
| **1. 技术可行性验证** | 10% | 🔄 进行中 | 浏览器控制已验证，提示词优化待调研 |
| 2. Extension 完整开发 | 20% | ⏳ | 目前仅 background.js 验证版 |
| 3. WebApp/控制台开发 | 15% | ⏳ | 目前仅测试中转页 |
| 4. Stagehand 核心移植 | 30% | ⏳ | Handler / Cache / Understudy |
| 5. LLM 集成 | 15% | ⏳ | Provider / Prompt / 解析 |
| 6. 产品化 | 10% | ⏳ | 错误处理 / 日志 / 测试 |

### 当前阶段详情（技术可行性验证）

| 验证项 | 内容 | 结论 |
|--------|------|------|
| ✅ 通信链路 | Server → WebApp → Extension → 浏览器 | 可行 |
| ✅ OOPIF | 跨域 iframe 操作能力 | 可行 |
| ✅ CDP 覆盖 | Chrome DevTools Protocol 方法 | 91% 可用 |
| ⏳ 事件回传 | 浏览器事件实时同步 | 待集成验证 |
| ⏳ 会话管理 | 多标签页/iframe 路由 | 待集成验证 |
| ⏳ 提示词优化 | 解决 LLM 提示词过量问题 | 待调研 |

**本阶段目标**：证明技术路线可行，**不是**实现完整功能。

### 待调研方向

| 方向 | 问题 | 参考 |
|------|------|------|
| 提示词过量 | 工具/上下文信息过多导致 token 消耗大 | MetaGPT 的工具处理机制 |

---

## 完成后获得的能力

### 核心能力

| 能力 | 说明 | 应用场景 |
|------|------|----------|
| **自然语言操作** | "点击登录按钮" → AI 自动定位并点击 | 流程自动化 |
| **跨域穿透** | 操作嵌套的第三方 iframe | 复杂网页交互 |
| **智能等待** | 自动等待页面加载/网络空闲 | 稳定性保障 |
| **数据提取** | AI 理解页面结构并提取信息 | 数据采集 |

### 技术指标

- **CDP 覆盖率**：91%（核心方法 100%）
- **响应延迟**：< 100ms（本地）
- **支持环境**：Chrome 120+

---

## 涉及项目介绍

### Stagehand（参考实现）

> **AI 驱动的浏览器自动化框架**

- 来源：开源项目
- 特点：LLM + CDP 直连浏览器
- 我们复用：分层架构、缓存机制、Handler 设计

### Nanobrowser（参考实现）

> **Chrome 扩展形式的浏览器自动化**

- 来源：开源项目
- 特点：MV3 扩展、多 Agent 协作
- 我们复用：chrome.debugger 使用模式、事件管理

### mimo（本项目）

> **融合 Stagehand + Nanobrowser 的企业级方案**

- 目标：内部工具 / 企业自动化
- 架构：Server（LLM 编排）→ WebApp（中转）→ Extension（执行）

---

## 架构简图

```
┌─────────────┐      SSE       ┌─────────────┐   sendMessage   ┌─────────────┐
│   Server    │ ─────────────► │   WebApp    │ ───────────────► │  Extension  │
│  (LLM+编排)  │ ◄───────────── │   (中转页)   │ ◄─────────────── │  (执行CDP)  │
└─────────────┘    HTTP POST   └─────────────┘    Response      └──────┬──────┘
                                                                       │
                                                                       ▼
                                                                ┌─────────────┐
                                                                │   浏览器    │
                                                                │  (目标页面)  │
                                                                └─────────────┘
```

---

## 下一步

### 阶段 2：Extension 完整开发

| 模块 | 当前状态 | 待完成 |
|------|----------|--------|
| background.js | 验证代码 | 重构为生产级代码 |
| Popup UI | 无 | 状态显示、连接管理 |
| Options 页面 | 无 | 配置项、服务端地址 |
| 权限管理 | 最小验证 | 完整权限声明与请求 |
| 错误处理 | 基础 | 重试、降级、用户提示 |

### 阶段 3：WebApp/控制台开发

| 模块 | 当前状态 | 待完成 |
|------|----------|--------|
| webapp.ts | 测试中转页 | 控制台界面 |
| 任务管理 | 无 | 任务列表、状态监控 |
| 日志查看 | console.log | 可视化日志面板 |
| 调试工具 | 无 | CDP 命令调试器 |

### 阶段 4：Stagehand 核心移植

| 模块 | 工作内容 |
|------|----------|
| Understudy 层 | 适配 DriverAdapter，替换原有 CDP 连接 |
| Handler 层 | 移植 actHandler / extractHandler / observeHandler |
| 缓存机制 | 移植 ActCache / AgentCache |
| Frame 管理 | 复用已验证的 sessionId 路由 |

### 阶段 5：LLM 集成

| 模块 | 工作内容 |
|------|----------|
| LLMProvider | 对接 OpenAI / Claude 等 |
| Prompt 工程 | 移植 Stagehand 的提示词模板 |
| 结果解析 | 处理 LLM 返回的操作指令 |

### 阶段 6：产品化

- 端到端测试
- 错误处理完善
- 文档与部署

---

## 关键验证结论

| 验证项 | 结论 |
|--------|------|
| chrome.debugger 能否替代直连 CDP？ | ✅ **可以**，91% 方法覆盖 |
| 能否操作跨域 iframe？ | ✅ **可以**，通过 sessionId 路由 |
| nodeId 会失效吗？ | ✅ **已解决**，使用 keepAttached 模式 |

**当前状态**：技术可行性验证进行中（~5%）
- ✅ 基础通信 + CDP 覆盖：已验证
- ⏳ 事件回传 + 会话管理：待集成验证
- ⏳ 提示词优化：待调研 MetaGPT

**风险提示**：
- 当前代码均为验证代码，生产化需要大量重构
- Extension UI/UX 设计未开始
- Stagehand 代码量较大，移植复杂度待评估
- LLM 调用成本和延迟需要实际测试验证

**待调研技术方向**：
- MetaGPT 工具调用优化模式 → 解决提示词/工具描述过量问题

