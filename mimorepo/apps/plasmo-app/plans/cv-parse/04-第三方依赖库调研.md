# 第三方依赖库调研：为什么“简历正文根XPath”不能直接靠 Readability

本章介绍成熟“主内容抽取”库在简历场景中的适用性与局限，并给出推荐用法：**作为弱信号**，辅助生成候选/打分，而不是直接输出根 XPath。

---

## 1. 相关问题类别

你要解决的是：

- **主内容容器识别**（main content extraction / boilerplate removal）的一种，但目标不是“文章正文”，而是“结构化简历正文”
- 且输出必须是 **可回放定位** 的 **原始 DOM 根容器 XPath**

这两个约束决定了：传统正文抽取库经常只能提供“正文片段”，而不能稳定返回“原 DOM 根节点 XPath”。

---

## 2. 常见库概览

### 2.1 `@mozilla/readability`

- **擅长**：新闻/博客/文章型页面的正文抽取（阅读模式）
- **输出**：通常是清洗/重排后的 `content`（HTML 字符串）+ `textContent` 等
- **局限**：
  - 返回的正文 HTML 可能是“重建后的片段”，不对应原 DOM 的唯一节点引用
  - 简历页更像“多区块结构化信息”，Readability 可能把侧栏/推荐/头部信息一起纳入，或反过来丢掉某些经历区块
- **推荐用法（弱信号）**：
  - 用它生成正文文本摘要，帮助判断“页面是否已加载出正文”
  - 或把其输出文本用于校验：候选容器 textPreview 与 readability 摘要的相似度（作为加分项）

### 2.2 `unfluff`（及类似 Node 生态实现）

- 思路与 Readability 类似，偏启发式抽取
- 简历场景下问题与 Readability 类似：**难以稳定映射回原 DOM 根 XPath**

### 2.3 Python 生态（`trafilatura` / `jusText` / `boilerpy3`）

- **擅长**：文本抽取、去模板、去噪
- **局限**：与浏览器端 DOM/XPath 的映射天然更远；适合作为服务端文本清洗工具，但不适合作为“根 XPath 决策器”的唯一信号

### 2.4 DOM Distiller（Chromium 阅读模式相关）

- 效果常与阅读模式对齐，但工程集成与依赖较重
- 同样面临“抽取结果 ≠ 原 DOM 节点”的问题

---

## 3. 为什么本任务更适合“锚点覆盖率 + 容器评分 + 兜底裁决”

简历页面的结构特点：

- 多模块：个人信息、教育、工作、项目、技能等分区块组成
- 强站点噪声：推荐职位、相似简历、引导下载 App、登录弹窗
- 需要输出：**原 DOM 的 root 容器 XPath**

因此更稳的路径是：

- 用 **anchors** 锁定正文区域（字段散点）
- 用 **candidates**（锚点祖先集合）生成可控搜索空间
- 用 **coverage/linkDensity/interactiveDensity** 等评分，选“最小且完整覆盖正文”的容器
- 不确定时，用 LLM 在 TopK 候选里裁决（仍输出 XPath）

这条路径可解释、可调参，并能与服务端编排形成闭环回退。

---

## 4. 如果仍想引入第三方库，推荐怎么融合（不破坏 XPath 目标）

推荐三种融合方式（由弱到强）：

- **方式 1：加载态检测**：readability 抽取到的正文文本长度达到阈值，才允许进入“根 XPath 识别”阶段（减少未加载完成时误判）。
- **方式 2：候选加分**：计算 `candidate.textPreview` 与 readability `textContent` 的相似度（如 token overlap），作为 candidate 的加分项。
- **方式 3：生成额外候选**：将 readability 推断的“主要内容块”对应的容器（若能在端侧定位到近似节点）加入 candidates 集合，但最终仍由评分/LLM 决策。

