# Mimo 快速开始

## 安装

```bash
# 在 nitro-app 中安装
pnpm add @mimo/lib
```

## 基础使用

### 1. 初始化 Mimo

```typescript
import { Mimo } from '@mimo/lib/core';

// 创建 Mimo 实例
const mimo = new Mimo({
  socket: {
    url: 'ws://localhost:3000', // Socket.IO 服务器地址
  },
  verbose: 1, // 日志级别: 0=静默, 1=正常, 2=调试
});

// 初始化连接
await mimo.init();
```

### 2. 执行浏览器操作

```typescript
// 使用自然语言描述执行操作
const result = await mimo.act('点击登录按钮');

console.log(result.success); // true
console.log(result.message);  // "Action completed"
console.log(result.actions);  // 执行的操作列表
```

### 3. 提取页面数据

```typescript
// 提取单个值
const product = await mimo.extract('获取商品价格');

console.log(product.extraction); // "¥299.00"

// 使用 Zod schema 提取结构化数据
import { z } from 'zod';

const productSchema = z.object({
  name: z.string(),
  price: z.string(),
  rating: z.string().optional(),
});

const productData = await mimo.extract('获取商品信息', productSchema);

console.log(productData.extraction);
// { name: "iPhone 15", price: "¥5999", rating: "4.8" }
```

### 4. 观察页面可用操作

```typescript
// 获取页面上可执行的操作
const actions = await mimo.observe('登录页面');

console.log(actions);
// [
//   { description: "点击登录按钮", selector: "#login-btn" },
//   { description: "输入用户名", selector: "#username" },
//   { description: "输入密码", selector: "#password" }
// ]
```

### 5. 使用 Agent 执行多步骤任务

```typescript
// 创建 Agent
const agent = mimo.agent({
  model: 'openai/gpt-4o-mini',
  maxSteps: 25,
});

// 执行复杂任务
const result = await agent.execute({
  instruction: '在亚马逊上搜索 iPhone 15，找到价格最便宜的选项并加入购物车',
});

console.log(result.success);    // true
console.log(result.completed);  // true
console.log(result.actions);    // 所有执行的操作步骤
console.log(result.usage);      // Token 使用统计
```

### 6. 使用 RemotePage 直接操作

```typescript
// 获取当前页面
const page = mimo.page;

// 导航到 URL
await page.goto('https://example.com');

// 点击元素
await page.click('#submit-button');

// 填充表单
await page.fill('#email', 'user@example.com');
await page.fill('#password', 'secret123');

// 截图
const screenshot = await page.screenshot();
```

### 7. 使用 Locator 精确定位元素

```typescript
const page = mimo.page;

// CSS 选择器
const button = page.locator('#login-button');
await button.click();

// XPath 深度定位
const element = page.deepLocator('//div[contains(@class, "product")]//span[@class="price"]');
const text = await element.innerText();
```

### 8. 管理浏览器标签页

```typescript
// 获取当前标签页
const activeTab = await mimo.getActiveTab();

// 获取所有标签页
const tabs = await mimo.getTabs();

// 切换到指定标签页
await mimo.switchToTab('tab-id-123');

// 关闭标签页
await mimo.closeTab('tab-id-123');
```

### 9. 监听事件

```typescript
// 连接事件
mimo.on('connected', () => {
  console.log('Mimo 已连接');
});

// 断开连接事件
mimo.on('disconnected', (data) => {
  console.log('Mimo 已断开:', data);
});

// 命令发送事件
mimo.on('command.sent', (data) => {
  console.log('命令已发送:', data);
});

// 命令结果事件
mimo.on('command.result', (data) => {
  console.log('命令结果:', data);
});

// 截图事件
mimo.on('screenshot', (data) => {
  console.log('收到截图:', data);
});

// 标签页变更事件
mimo.on('tab.changed', (data) => {
  console.log('标签页已变更:', data);
});

// 错误事件
mimo.on('error', (data) => {
  console.error('错误:', data);
});
```

### 10. 清理资源

```typescript
// 正常关闭
await mimo.close();

// 强制关闭（忽略错误）
await mimo.close({ force: true });
```

## 完整示例

```typescript
import { Mimo } from '@mimo/lib/core';

async function main() {
  // 1. 创建并初始化 Mimo
  const mimo = new Mimo({
    socket: { url: 'ws://localhost:3000' },
    verbose: 1,
  });

  await mimo.init();

  // 2. 导航到网站
  await mimo.page.goto('https://example.com/login');

  // 3. 执行登录操作
  const loginResult = await mimo.act('输入用户名和密码，然后点击登录');
  if (!loginResult.success) {
    console.error('登录失败:', loginResult.message);
    await mimo.close();
    return;
  }

  // 4. 提取用户信息
  const userInfo = await mimo.extract('获取当前登录用户的信息');
  console.log('用户信息:', userInfo.extraction);

  // 5. 获取操作历史
  const history = await mimo.history();
  console.log('操作历史:', history);

  // 6. 获取使用指标
  const metrics = await mimo.metrics();
  console.log('使用指标:', metrics);

  // 7. 清理资源
  await mimo.close();
}

main().catch(console.error);
```

## 配置选项

```typescript
const mimo = new Mimo({
  // Socket.IO 配置
  socket: {
    url: 'ws://localhost:3000',      // 服务器地址
    autoReconnect: true,             // 自动重连
    reconnectInterval: 1000,         // 重连间隔 (ms)
  },

  // 模型配置
  model: 'openai/gpt-4o-mini',

  // 日志配置
  verbose: 1,                        // 0=静默, 1=正常, 2=调试
  logger: (logLine) => {             // 自定义日志函数
    console.log(`[${logLine.level}] ${logLine.message}`);
  },

  // 其他选项
  cacheDir: './cache',               // 缓存目录
  commandTimeout: 30000,             // 命令超时 (ms)
  defaultTabId: 'default',           // 默认标签页 ID
});
```

## 错误处理

```typescript
import {
  MimoInitError,
  MimoTimeoutError,
  MimoNotConnectedError,
  MimoCommandError,
} from '@mimo/lib/core';

try {
  await mimo.init();
  await mimo.act('some action');
} catch (error) {
  if (error instanceof MimoInitError) {
    console.error('初始化失败:', error.message);
  } else if (error instanceof MimoTimeoutError) {
    console.error('操作超时:', error.timeout);
  } else if (error instanceof MimoNotConnectedError) {
    console.error('未连接到服务器');
  } else if (error instanceof MimoCommandError) {
    console.error('命令执行失败:', error.message);
    console.error('命令 ID:', error.commandId);
    console.error('命令详情:', error.command);
  }
}
```

## 下一步

- 阅读 [核心概念](./01-核心概念.md) 了解 Mimo 的架构
- 查看 [API 参考](./02-API参考.md) 了解完整 API
- 浏览 [使用示例](./03-使用示例.md) 学习更多用法
