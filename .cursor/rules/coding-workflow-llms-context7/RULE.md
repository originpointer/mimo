---
description: "编码/改逻辑/接入依赖前的工作流：优先阅读 @llms.txt（定位本仓库关键入口），如涉及第三方库则先用 Context7 明确 API（参数/返回值/错误行为），与用户确认细节后再开始编码。"
alwaysApply: false
---

当你准备对代码库进行任何会改变行为的工作（实现功能、修 bug、重构、接入第三方库/框架/SDK、编写/修改 API、写测试、调整配置导致逻辑变化）时，必须遵循以下流程。除非用户明确要求“只讨论不写代码/不改代码”，否则不得跳过。

## 强制流程（按顺序执行）

1) 先读 @llms.txt（本仓库优先知识）
- 先从 `llms.txt` 中提到的“关键入口文件”入手定位代码与约定。
- 若需求与 Nitro/h3/Orama/skills 索引或检索相关，优先阅读并引用这些入口再做改动设计：
  - `server/plugins/skillsIndex.ts`
  - `server/routes/api/skills/search.ts`
  - `server/utils/skillsIndex/*`（例如 `orama.ts` / `search.ts` / `loader.ts` / `types.ts` 等）

2) 如涉及第三方库/框架/SDK：先用 Context7 把 API 查清楚（不得凭记忆猜）
- 必须先调用 `resolve-library-id` 获取 Context7 `libraryId`，再调用 `query-docs`。
- 查询结果必须覆盖（至少）：
  - 具体 API 名称（函数/类/方法）
  - 参数列表（每个参数含义、可选项、默认值）
  - 返回值（类型/结构、关键字段语义）
  - 错误与边界行为（抛异常 vs 返回错误对象、错误码/字段）
- 如果 Context7 覆盖不足或找不到：必须明确告知用户“不确定”，并改用以下方式之一后再继续：
  - 阅读本仓库现有实现/类型定义（优先）
  - 请求用户提供官方文档链接/版本信息/代码片段

3) 编码前先与用户确认细节（把不确定点问清楚）
- 在动手改代码之前，必须向用户提出需要确认的要点，并等待确认后再实施。常见需确认项：
  - 期望行为与边界条件（空输入、错误输入、超长文本、并发等）
  - 兼容性要求（运行环境/版本、是否需要向后兼容）
  - 性能与资源约束（索引构建时间、内存、QPS 等）
  - 测试/验收方式（要不要加/改测试、预期输出）

4) 最后再编码与验证
- 按用户确认的细节实施改动。
- 完成后做最小必要验证：优先运行相关测试或提供可复现的最小示例调用（不启动长驻服务，除非用户要求）。

## 输出习惯
- 在开始编码前：先用简短要点引用/总结 `@llms.txt` 中与当前任务直接相关的内容（仅引用必要部分）。
- 在涉及第三方库时：在回复中明确列出已确认的 API 形态（参数/返回值/错误行为），并注明来自 Context7 的证据。

